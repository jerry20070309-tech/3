<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TRIDENT V52 MID CAP</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{background:#000;color:#fff;font-family:monospace}
.card{background:#111;border:1px solid #222;padding:12px;margin-bottom:8px}
.bar{height:6px;background:#222;margin-top:6px}
.fill{height:6px;background:#00ff88}
.log{background:#111;border:1px solid #333;height:300px;overflow:auto;padding:10px}
</style>
</head>
<body class="p-6">

<h1 class="text-xl mb-4">TRIDENT V52 MID CAP</h1>
<button onclick="ignite()" class="bg-green-600 px-4 py-2 mb-4">å•Ÿå‹•æƒæ</button>

<div id="progress" class="bar mb-4">
<div id="progressFill" class="fill" style="width:0%"></div>
</div>

<div class="flex gap-6">
<div class="flex-1" id="list"></div>
<div class="w-80">
<div class="log" id="log"></div>
</div>
</div>

<script>

const ACTIVE_LIMIT = 100
const REFRESH_INTERVAL = 30000

let universe=[]
let active=[]
let market={}
let alerted=new Set()
let ws

// ===== ä¸»æµæ’é™¤ =====
const EXCLUDE = [
"BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT",
"XRPUSDT","ADAUSDT","DOGEUSDT"
]

// ===== å•Ÿå‹• =====

async function ignite(){
await loadUniverse()
await initActive()
startWS()
startTimer()
}

// ===== ä¸­æ®µå¸‚å ´å»ºæ±  =====

async function loadUniverse(){

const tickers=await fetch("https://fapi.binance.com/fapi/v1/ticker/24hr")
.then(r=>r.json())

const sorted=tickers
.filter(t=>t.symbol.endsWith("USDT"))
.filter(t=>!EXCLUDE.includes(t.symbol))
.sort((a,b)=>b.quoteVolume-a.quoteVolume)

// åˆ‡æ‰å‰30ï¼ˆé¡å¸‚å€¼å‰æ®µï¼‰
const noTop=sorted.slice(30)

// åˆ‡æ‰å°¾æ®µä½æµå‹•ï¼ˆæœ€å¾Œ120ï¼‰
const mid=noTop.slice(0,noTop.length-120)

// åŠ æˆäº¤é‡é–€æª»
const filtered=mid.filter(t=>parseFloat(t.quoteVolume)>20000000)

universe=filtered.map(t=>t.symbol)
}

// ===== åªå–å‰100åšç­–ç•¥ =====

async function initActive(){

active=universe.slice(0,ACTIVE_LIMIT)

for(const s of active){
await loadSymbol(s)
}

render()
}

async function loadSymbol(s){

const k=await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=15m&limit=50`)
.then(r=>r.json())

const closes=k.map(x=>parseFloat(x[4]))

market[s]={
price:closes.at(-1),
avg:closes.reduce((a,b)=>a+b)/closes.length,
slope:(closes.at(-1)-closes[0])/closes[0]*100,
score:0
}

calcScore(s)
}

function calcScore(s){

const d=market[s]
let score=0

if(d.price>d.avg) score+=25
if(d.slope>1.2) score+=25
if(d.price>d.avg*1.01) score+=25
if(d.slope>2) score+=25

d.score=score

if(score==100 && !alerted.has(s)){
log("ğŸ”¥ STRONG ENTRY "+s+" 100")
alerted.add(s)
}
}

// ===== åªé‡ç®— ä¸é‡æŠ“Kç·š =====

function recalc(){
active.forEach(s=>calcScore(s))
render()
}

// ===== WebSocket åªæ›´æ–°åƒ¹æ ¼ =====

function startWS(){

ws=new WebSocket("wss://fstream.binance.com/ws/!ticker@arr")

ws.onmessage=e=>{
const arr=JSON.parse(e.data)
arr.forEach(t=>{
if(market[t.s]){
market[t.s].price=parseFloat(t.c)
calcScore(t.s)
}
})
render()
}
}

// ===== 30ç§’é‡ç®— =====

function startTimer(){

let elapsed=0

setInterval(()=>{
elapsed+=100
document.getElementById("progressFill").style.width=
(elapsed/REFRESH_INTERVAL*100)+"%"

if(elapsed>=REFRESH_INTERVAL){
elapsed=0
recalc()
}
},100)

}

// ===== UI =====

function render(){

const container=document.getElementById("list")
container.innerHTML=""

active
.sort((a,b)=>market[b].score-market[a].score)
.forEach(s=>{
const d=market[s]
const card=document.createElement("div")
card.className="card"
card.innerHTML=`
<div class="flex justify-between">
<div>${s}</div>
<div>${d.score}</div>
</div>
<div class="bar">
<div class="fill" style="width:${d.score}%"></div>
</div>
`
container.appendChild(card)
})
}

function log(text){
const div=document.createElement("div")
div.innerText=text
document.getElementById("log").prepend(div)
}

</script>
</body>
</html>
