<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>V7 Precision Long Scanner</title>
<style>
body{background:#0f172a;color:#e2e8f0;font-family:Arial}
h1{color:#38bdf8}
button{padding:8px 12px;margin:5px;border:none;background:#2563eb;color:white;border-radius:6px}
.card{
background:#1e293b;
padding:12px;
margin:10px 0;
border-radius:8px;
border:1px solid #334155
}
.green{color:#22c55e}
.red{color:#ef4444}
input{padding:6px;margin:5px;background:#0f172a;color:white;border:1px solid #334155}
</style>
</head>
<body>

<h1>ğŸ¹ V7 Precision Long Scanner</h1>

<div>
<label>TG Token:</label>
<input id="tgToken" style="width:400px">
</div>

<div>
<label>Chat ID:</label>
<input id="tgChat" style="width:200px">
</div>

<button onclick="testPush()">ğŸ“¢ æ¸¬è©¦æ¨æ’­</button>
<button onclick="startScan()">â–¶ é–‹å§‹æƒæ</button>

<div id="output"></div>

<script>

let alerted=new Set()
let recordSet=new Set()

// =============================
// MA
// =============================
function ma(data,len){
if(data.length<len) return 0
let sum=0
for(let i=data.length-len;i<data.length;i++){
sum+=data[i].close
}
return sum/len
}

// =============================
// TG æ¨æ’­
// =============================
async function sendTG(symbol,price,score){

let token=document.getElementById("tgToken").value
let chat=document.getElementById("tgChat").value

try{
let res=await fetch(`https://api.telegram.org/bot${token}/sendMessage`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
chat_id:chat,
text:`ğŸš€ ${symbol}\nåƒ¹æ ¼: ${price}\nåˆ†æ•¸: ${score}`
})
})

let data=await res.json()
console.log("TG:",data)

}catch(e){
console.log(e)
}
}

// =============================
// æ¸¬è©¦æ¨æ’­
// =============================
function testPush(){
sendTG("TEST",999,100)
}

// =============================
// Render Card
// =============================
function renderCard(symbol,price,score){

let div=document.createElement("div")
div.className="card"

div.innerHTML=`
<div><b>${symbol}</b></div>
<div>åƒ¹æ ¼: ${price}</div>
<div class="green">åˆ†æ•¸: ${score}</div>
`

document.getElementById("output").prepend(div)
}

// =============================
// Record
// =============================
function addRecord(symbol,price){
console.log("ç´€éŒ„:",symbol,price)
}

// =============================
// å‡è³‡æ–™ç”Ÿæˆ (æ¸¬è©¦ç”¨)
// =============================
function generateData(){

let arr=[]
let base=100

for(let i=0;i<120;i++){

let change=(Math.random()-0.4)*2
base+=change

arr.push({
open:base-1,
close:base,
high:base+1,
low:base-2,
volume:Math.random()*1000+500
})

}

return arr
}

// =============================
// ä¸»ç­–ç•¥
// =============================
function runStrategy(symbol,k15){

if(!k15||k15.length<99) return

let price=k15[k15.length-1].close
let prevClose=k15[k15.length-2].close

let ma7=ma(k15,7)
let ma25=ma(k15,25)
let ma99=ma(k15,99)

let ma7_prev=ma(k15.slice(0,-1),7)

// ===== åªåšå¤šç¡¬éæ¿¾ =====
let aboveMA7=price>ma7
let ma7Up=ma7>ma7_prev
let breakLow=price<k15[k15.length-5].low

if(!aboveMA7) return
if(!ma7Up) return
if(breakLow) return

// ===== è©•åˆ† =====
let score=0

let slice=35
let recent=k15.slice(-slice)

let high35=Math.max(...recent.map(c=>c.high))
let break4=price>high35
if(break4) score+=20

let avgVol=recent.reduce((a,b)=>a+b.volume,0)/slice
let volNow=k15[k15.length-1].volume
if(volNow>avgVol*2) score+=20   // çˆ†é‡2x

let structure=ma7>ma25&&ma25>ma99
if(structure) score+=20

let bigOrder=true
if(bigOrder) score+=20

let denseOrder=true
if(denseOrder) score+=15

let shortPump=(price/prevClose)>1.015
if(shortPump) score+=10

let rapidPull=(price-ma7)/ma7<0.01
if(rapidPull) score+=15

// ===== éç†±éæ¿¾ =====
let overExtend=(price-ma7)/ma7>0.04
if(overExtend) score-=30

// ===== è§¸ç™¼ =====
if(score>=75){

renderCard(symbol,price,score)

if(score>=85&&!alerted.has(symbol)){
sendTG(symbol,price,score)
alerted.add(symbol)
}

if(score>=90&&!recordSet.has(symbol)){
addRecord(symbol,price)
recordSet.add(symbol)
}

}

}

// =============================
// å•Ÿå‹•æƒæ
// =============================
function startScan(){

document.getElementById("output").innerHTML=""

let data=generateData()
runStrategy("BTCUSDT",data)

}

</script>

</body>
</html>
