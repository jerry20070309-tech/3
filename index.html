<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>⚡ TRIDENT V17 - ZERO FETCH EDITION</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-yellow-500 font-mono p-5">

    <div class="flex justify-between border-b border-zinc-800 pb-4 mb-4">
        <h1 class="text-xl font-black italic">TRIDENT V17 (隱形模式)</h1>
        <button id="startBtn" onclick="stealthStart()" class="bg-yellow-600 text-black px-6 py-1 rounded font-bold">啟動引擎</button>
    </div>

    <div id="display" class="grid grid-cols-2 gap-4"></div>

<script>
    const SYMBOLS = ['PIPPINUSDT', 'BNBUSDT', 'ADAUSDT'];
    let store = {};
    let ws = null;

    // 1. 隱形初始化：只跑一次，且每個幣種間隔 1 秒，絕不爆量
    async function stealthStart() {
        document.getElementById('startBtn').style.display = 'none';
        
        for (const s of SYMBOLS) {
            // 每 1 秒才抓一次初始支撐位，模擬真人行為
            await new Promise(r => setTimeout(r, 1000));
            
            const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${s}&interval=15m&limit=50`);
            const data = await res.json();
            
            // 執行 image_4cedfd.jpg 中的策略邏輯
            const lows = data.map(k => parseFloat(k[3]));
            store[s] = { support: Math.min(...lows), price: 0 };
            console.log(`${s} 基線已建立`);
        }

        // 初始化結束後，手動提示你清空面板紀錄，達成「零項目」
        console.log("初始化完畢！現在你可以按下 Network 面板左上角的『禁止符號』清空紀錄，之後將不會再產生任何請求項目。");
        
        startFullWS();
    }

    // 2. 數據流完全走 WS 通道，Network 面板將保持靜止
    function startFullWS() {
        const streams = SYMBOLS.map(s => `${s.toLowerCase()}@ticker`).join('/');
        ws = new WebSocket(`wss://stream.binance.com:9443/ws/${streams}`);

        ws.onmessage = (e) => {
            const msg = JSON.parse(e.data);
            const s = msg.s;
            const price = parseFloat(msg.c);
            
            store[s].price = price;
            
            // 策略判斷：價格跌破支撐
            const isLiq = price < store[s].support;
            
            render(s, isLiq);
        };
    }

    function render(s, isLiq) {
        const el = document.getElementById(`card-${s}`) || createCard(s);
        el.className = `p-4 border ${isLiq ? 'border-red-600 bg-red-900' : 'border-zinc-800 bg-zinc-950'} rounded`;
        el.innerHTML = `<div class="text-white font-bold">${s}</div>
                        <div class="text-xs text-zinc-500">支撐: ${store[s].support}</div>
                        <div class="text-lg">現價: ${store[s].price}</div>`;
    }

    function createCard(s) {
        const div = document.createElement('div');
        div.id = `card-${s}`;
        document.getElementById('display').appendChild(div);
        return div;
    }
</script>
</body>
</html>
