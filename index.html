<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>PIPPINUSDT æ¸…ç®—å‹æ…‹æƒæå™¨</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: #00ff00; padding: 20px; }
        #log { border: 1px solid #333; height: 400px; overflow-y: auto; padding: 10px; background: #000; }
        .alert { color: #ff4444; font-weight: bold; background: #441111; padding: 5px; }
    </style>
</head>
<body>
    <h2>PIPPINUSDT ç›£æ§ä¸­... (æ¯ 3 ç§’æ›´æ–°)</h2>
    <div id="status">æ­£åœ¨è¨ˆç®—åˆå§‹æ”¯æ’ä½...</div>
    <div id="log"></div>

    <script>
        const SYMBOL = 'PIPPINUSDT';
        const BASE_URL = 'https://api.binance.com';
        let supportLevel = 0;
        let avgVolume = 0;

        const logDiv = document.getElementById('log');
        const statusDiv = document.getElementById('status');

        function addLog(msg, isAlert = false) {
            const p = document.createElement('p');
            if (isAlert) p.className = 'alert';
            p.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logDiv.prepend(p);
        }

        async function startScanner() {
            while (true) {
                try {
                    // --- å°åŒ… 1: è«‹æ±‚ K ç·š (Packet A) ---
                    const klineRes = await fetch(`${BASE_URL}/api/v3/klines?symbol=${SYMBOL}&interval=15m&limit=50`);
                    const klines = await klineRes.json();
                    
                    let minLow = Infinity;
                    let totalVol = 0;
                    klines.forEach(k => {
                        minLow = Math.min(minLow, parseFloat(k[3])); // Low
                        totalVol += parseFloat(k[5]); // Volume
                    });
                    supportLevel = minLow;
                    avgVolume = totalVol / klines.length;
                    
                    statusDiv.innerText = `ç•¶å‰æ”¯æ’ä½: ${supportLevel} | åŸºæº–å‡é‡: ${avgVolume.toFixed(2)}`;

                    // åš´æ ¼éµå®ˆï¼šç­‰å¾… 1.5 ç§’å†ç™¼é€ç¬¬äºŒå€‹å°åŒ…
                    await new Promise(r => setTimeout(r, 1500));

                    // --- å°åŒ… 2: è«‹æ±‚æœ€æ–°åƒ¹æ ¼ (Packet B) ---
                    const tickerRes = await fetch(`${BASE_URL}/api/v3/ticker/24hr?symbol=${SYMBOL}`);
                    const ticker = await tickerRes.json();
                    const lastPrice = parseFloat(ticker.lastPrice);
                    const currentVol = parseFloat(ticker.volume) / 96; // ä¼°ç®— 15m é‡

                    // å‹æ…‹åˆ¤æ–·
                    if (lastPrice < supportLevel && currentVol > (avgVolume * 2.5)) {
                        addLog(`ğŸ”¥ åµæ¸¬åˆ°æ¸…ç®—è¨Šè™Ÿï¼åƒ¹æ ¼ ${lastPrice} ç ´æ”¯æ’ï¼Œæˆäº¤é‡æš´å¢ï¼`, true);
                    } else {
                        addLog(`æƒææ­£å¸¸ï¼šåƒ¹æ ¼ ${lastPrice} é«˜æ–¼æ”¯æ’`);
                    }

                    // å‰©é¤˜æ™‚é–“è£œè¶³ 1.5 ç§’ï¼Œç¢ºä¿æ•´å€‹ while å¾ªç’°æ˜¯å¤§ç´„ 3 ç§’ä¸€æ¬¡
                    await new Promise(r => setTimeout(r, 1500));

                } catch (err) {
                    addLog("API è«‹æ±‚éŒ¯èª¤: " + err.message);
                    await new Promise(r => setTimeout(r, 3000)); // éŒ¯èª¤å¾Œç­‰ 3 ç§’å†è©¦
                }
            }
        }

        startScanner();
    </script>
</body>
</html>
