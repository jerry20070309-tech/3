<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>âš¡ SNIPER V13.0 | AUTO-HUNT MODE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');
        body { background: #020202; color: #FFD700; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
        .card { background: #0a0a0a; border: 1px solid #1a1a1a; transition: 0.3s; position: relative; cursor: pointer; }
        /* å·¨é¯¨å¤§å–®é–ƒçˆ */
        .whale-alert { border: 2px solid #ef4444 !important; background: #2a0000 !important; animation: whale-blink 0.5s infinite; }
        @keyframes whale-blink { 0%, 100% { box-shadow: 0 0 20px #ef4444; } 50% { box-shadow: 0 0 5px #ef4444; } }
        /* çˆ†å€‰é–ƒçˆ */
        .liq-alert { border: 2px solid #8b5cf6 !important; background: #1e1b4b !important; animation: liq-blink 0.5s infinite; }
        @keyframes liq-blink { 0%, 100% { box-shadow: 0 0 20px #8b5cf6; } 50% { box-shadow: 0 0 5px #8b5cf6; } }
        
        .pinned { border: 2px solid #3b82f6 !important; background: #081221 !important; }
        .score-tag { font-weight: 900; background: #FFD700; color: #000; padding: 0 4px; border-radius: 2px; }
        #logContainer::-webkit-scrollbar { width: 4px; }
        #logContainer::-webkit-scrollbar-thumb { background: #333; }
    </style>
</head>
<body class="h-screen flex flex-col text-[10px]">

    <header class="p-4 border-b border-yellow-900 bg-black flex justify-between items-center shrink-0">
        <div class="flex items-center gap-4">
            <h1 class="text-2xl font-black text-yellow-500 italic">âš¡ SNIPER V13.0</h1>
            <div class="text-xs font-bold text-zinc-500 italic" id="marketStatus">æƒæå…¨å¸‚å ´ä¸­...</div>
        </div>
        <div class="flex gap-4">
            <div class="bg-zinc-900 px-3 py-1 rounded text-green-400 font-bold border border-zinc-700" id="clock">00:00:00</div>
            <button id="sysBtn" onclick="toggleSystem()" class="bg-red-600 text-white px-8 py-1 rounded font-black hover:bg-red-500">START RADAR</button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <main class="flex-1 p-3 overflow-y-auto bg-black">
            <div id="dashboard" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3"></div>
        </main>

        <aside class="w-80 border-l border-yellow-900 bg-zinc-950 flex flex-col shrink-0">
            <div class="p-3 border-b border-zinc-800 text-red-500 font-bold flex justify-between uppercase">
                <span>ğŸ›¡ï¸ å·¨é¯¨/çˆ†å€‰å¯¦æ™‚æ—¥èªŒ</span>
            </div>
            <div id="logContainer" class="flex-1 overflow-y-auto p-2 space-y-2"></div>
        </aside>
    </div>

<script>
    let isRunning = false;
    let stats = {}, pinned = new Set();
    let prevOI = {}; // ç´€éŒ„ B2 æŒå€‰æ­·å²
    const WHALE_LIMIT = 50000; // $50k è¦–ç‚ºå·¨é¯¨

    // æ ¸å¿ƒç›£æ§å¾ªç’°
    async function scan() {
        if(!isRunning) return;
        try {
            // åŒæ­¥ç²å– Ticker(P2), OpenInterest(B2), Liquidation(P3)
            const [tRes, oiRes, lRes] = await Promise.all([
                fetch('https://fapi.binance.com/fapi/v1/ticker/24hr'),
                fetch('https://fapi.binance.com/fapi/v1/openInterest?symbol=ALL'), // æ³¨æ„ï¼šé€™éƒ¨åˆ†éœ€è¦å¾Œç«¯æˆ–å–®é»è«‹æ±‚ï¼Œé€™è£¡æ¨¡æ“¬é‚è¼¯
                fetch('https://fapi.binance.com/fapi/v1/allForceOrders?limit=10')
            ]);
            
            const tickers = await tRes.json();
            const liqs = await lRes.json();
            
            // çˆ†å€‰æ•¸æ“šæ˜ å°„
            const liqMap = {};
            liqs.forEach(l => { liqMap[l.symbol] = l; });

            tickers.forEach(t => {
                const s = t.symbol;
                if (!s.endsWith('USDT')) return;

                const price = parseFloat(t.lastPrice);
                const vol24h = parseFloat(t.quoteVolume);
                const change = parseFloat(t.priceChangePercent);
                
                // --- æ¨¡æ“¬é«˜å‹ç‡è©•åˆ†é‚è¼¯ (75åˆ†é–€æª») ---
                let score = 0;
                if (Math.abs(change) > 3) score += 30; // å‹•æ…‹åˆ†
                if (vol24h > 1e8) score += 30; // æˆäº¤é‡åˆ†
                const spread = (parseFloat(t.highPrice) - parseFloat(t.lowPrice)) / price;
                if (spread < 0.02) score += 20; // è“„å‹¢åˆ† (SQZ)
                
                // --- B2 æŒå€‰è®Šå‹• (æ¨¡æ“¬) ---
                // å¯¦å‹™ä¸Šéœ€å€‹åˆ¥ç²å– symbol OIï¼Œæ­¤è™•ç‚ºé—œéµæ›´æ–°é‚è¼¯
                const currentOI = vol24h / 100; // æ¨¡æ“¬æ•¸æ“š
                const oiChange = prevOI[s] ? currentOI - prevOI[s] : 0;
                prevOI[s] = currentOI;

                // --- P2 å·¨é¯¨åˆ¤å®š ---
                const isWhale = (price * (vol24h / 10000)) > WHALE_LIMIT; 
                const isLiq = liqMap[s] ? true : false;

                stats[s] = { 
                    s, price, change, score, isWhale, isLiq, 
                    liqAmount: liqMap[s] ? parseFloat(liqMap[s].lastQty) * price : 0,
                    oiChange 
                };

                // --- [è‡ªå‹•å®šé¸é‚è¼¯] ---
                if (score >= 75) {
                    if (!pinned.has(s)) {
                        pinned.add(s);
                        addLog(s, `ğŸ¯ è©•åˆ†é”æ¨™ (${score.toFixed(0)}) è‡ªå‹•å®šé¸ç›£æ§`, 'text-yellow-500');
                    }
                }
            });

            render();
        } catch (e) { console.error(e); }
        setTimeout(scan, 3000); // 3 ç§’åŒæ­¥å¾ªç’°
    }

    function render() {
        const dashboard = document.getElementById('dashboard');
        // åªé¡¯ç¤º 75 åˆ†ä»¥ä¸Šæˆ–è¢«å®šé¸çš„å¹£å°
        const list = Object.values(stats)
            .filter(x => x.score >= 75 || pinned.has(x.s))
            .sort((a,b) => (pinned.has(b.s) - pinned.has(a.s)) || (b.score - a.score));

        dashboard.innerHTML = list.map(x => {
            let statusClass = "card";
            if (x.isLiq) statusClass += " liq-alert";
            else if (x.isWhale) statusClass += " whale-alert";
            else if (pinned.has(x.s)) statusClass += " pinned";

            return `
                <div class="${statusClass} p-3 rounded-lg" onclick="togglePin('${x.s}')">
                    <div class="flex justify-between items-start">
                        <span class="score-tag">SCORE: ${x.score.toFixed(0)}</span>
                        <span class="${x.oiChange >= 0 ? 'text-green-500' : 'text-red-500'} font-bold">
                            B2: ${x.oiChange > 0 ? 'â–²' : 'â–¼'}
                        </span>
                    </div>
                    <div class="flex justify-between items-end my-2">
                        <h2 class="text-2xl font-black text-white">${x.s.replace('USDT','')}</h2>
                        <div class="text-right">
                            <div class="text-lg font-bold ${x.change >= 0 ? 'text-green-500' : 'text-red-500'}">${x.change}%</div>
                            <div class="text-zinc-500">$${x.price.toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="border-t border-zinc-800 pt-2 grid grid-cols-2 gap-1 text-[8px]">
                        <div class="${x.isWhale ? 'text-red-400 font-bold animate-pulse' : 'text-zinc-600'}">P2 WHALE: ${x.isWhale ? 'DETECTED' : 'NONE'}</div>
                        <div class="${x.isLiq ? 'text-purple-400 font-bold animate-pulse' : 'text-zinc-600'}">P3 LIQ: $${x.liqAmount.toFixed(0)}</div>
                    </div>
                    ${pinned.has(x.s) ? '<div class="absolute -top-1 -right-1 text-[10px]">ğŸ“Œ</div>' : ''}
                </div>
            `;
        }).join('');
    }

    function addLog(s, msg, colorClass = 'text-zinc-400') {
        const container = document.getElementById('logContainer');
        const div = document.createElement('div');
        div.className = `p-2 bg-zinc-900 border-l-2 border-yellow-600 ${colorClass}`;
        div.innerHTML = `<b>${s}</b>: ${msg} <span class="float-right text-[8px] opacity-50">${new Date().toLocaleTimeString()}</span>`;
        container.prepend(div);
        if (container.children.length > 20) container.lastChild.remove();
    }

    function togglePin(s) {
        pinned.has(s) ? pinned.delete(s) : pinned.add(s);
        render();
    }

    function toggleSystem() {
        isRunning = !isRunning;
        const btn = document.getElementById('sysBtn');
        btn.innerText = isRunning ? "STOP RADAR" : "START RADAR";
        btn.className = isRunning ? "bg-zinc-800 text-zinc-400 px-8 py-1 rounded" : "bg-red-600 text-white px-8 py-1 rounded";
        if(isRunning) scan();
    }

    // æ™‚é˜
    setInterval(() => {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString();
    }, 1000);
</script>
</body>
</html>
