<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>V8 æ³¢æ®µè·Ÿéš¨ç‰ˆ</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{background:#050505;color:#d4d4d8;font-family:monospace;overflow:hidden}
.card{background:#0f0f11;border:1px solid #222;padding:12px;border-radius:8px;transition:.3s}
.card:hover{transform:scale(1.02)}
.progress{height:3px;background:#3b82f6;width:0%}
.high{border:2px solid #22c55e}
.mid{border:2px solid #f59e0b}
.low{border:2px solid #ef4444}
.exit{border:2px solid #ef4444}
.hold{border:2px solid #22c55e}
</style>
</head>

<body class="p-6 h-screen flex flex-col">

<header class="flex justify-between items-center mb-4">
<h1 class="text-2xl font-bold">ğŸ¹ V8 æ³¢æ®µè·Ÿéš¨ç‰ˆ</h1>

<div class="flex items-center gap-4">
<input id="tgToken" placeholder="TG BOT TOKEN" class="px-2 py-1 bg-zinc-800 rounded">
<input id="tgChat" placeholder="CHAT ID" class="px-2 py-1 bg-zinc-800 rounded">

<div class="w-48 bg-zinc-800 rounded-full overflow-hidden">
<div id="bar" class="progress"></div>
</div>

<button onclick="testPush()" class="bg-green-600 px-4 py-2 rounded">æ¸¬è©¦æ¨æ’­</button>
<button id="toggle" onclick="toggleSystem()" class="bg-blue-600 px-4 py-2 rounded">é–‹å§‹æƒæ</button>
</div>
</header>

<div class="flex flex-1 gap-4 overflow-hidden">
<div id="main" class="flex-1 grid grid-cols-3 gap-3 overflow-y-auto"></div>
<div class="w-80 border border-zinc-800 rounded p-2 overflow-y-auto">
<h2 class="text-sm mb-2">é«˜åˆ†ç´€éŒ„æ¿</h2>
<div id="record"></div>
</div>
</div>

<script>

let running=false
let positions={}
const MIN_QUOTE_VOLUME=3000000
const MAX_LOSS=10

async function sendTG(text){
let token=document.getElementById("tgToken").value.trim()
let chat=document.getElementById("tgChat").value.trim()
if(!token||!chat) return
try{
await fetch(`https://api.telegram.org/bot${token}/sendMessage`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({chat_id:chat,text:text})
})
}catch(e){}
}

function testPush(){ sendTG("V8 æ¸¬è©¦æ¨æ’­æˆåŠŸ") }

function ma(data,n){
if(data.length<n) return 0
let sum=0
for(let i=data.length-n;i<data.length;i++){
sum+=parseFloat(data[i][4])
}
return sum/n
}

async function refreshAll(){
if(!running) return
try{
let tickers=await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr').then(r=>r.json())
let list=tickers
.filter(t=>t.symbol.endsWith('USDT'))
.filter(t=>parseFloat(t.quoteVolume)>MIN_QUOTE_VOLUME)
.sort((a,b)=>b.quoteVolume-a.quoteVolume)
.slice(35,135)

for(let t of list){
await loadSymbol(t.symbol)
await new Promise(r=>setTimeout(r,100))
}
}catch(e){}
}

async function calculateSupport(s,entry){
try{
let k1m=await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1m&limit=60`).then(r=>r.json())
if(!k1m||k1m.length<50) return null

let recent=k1m.slice(-50)
let support=Math.min(...recent.map(c=>parseFloat(c[3])))
let riskDistance=(entry-support)/entry
if(riskDistance<=0) return null

let positionSize=MAX_LOSS/riskDistance
let leverage=positionSize/10

return {
support:support.toFixed(6),
riskPercent:(riskDistance*100).toFixed(2),
leverage:leverage.toFixed(1)
}
}catch(e){return null}
}

async function loadSymbol(s){

try{

let k15=await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=15m&limit=120`).then(r=>r.json())
if(!k15||k15.length<100) return

let k1d=await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1d&limit=5`).then(r=>r.json())
if(!k1d||k1d.length<3) return

let price=parseFloat(k15[k15.length-1][4])
let prevClose=parseFloat(k15[k15.length-2][4])

let ma7=ma(k15,7)
let ma25=ma(k15,25)
let ma99=ma(k15,99)
let ma7_prev=ma(k15.slice(0,-1),7)

if(price<=ma7) return
if(ma7<=ma7_prev) return

let score=0
let slice=35
let recent=k15.slice(-slice)
let high35=Math.max(...recent.map(c=>parseFloat(c[2])))
if(price>high35) score+=20

let avgVol=recent.reduce((a,b)=>a+parseFloat(b[5]),0)/slice
let volNow=parseFloat(k15[k15.length-1][5])
if(volNow>avgVol*2) score+=20

if(ma7>ma25&&ma25>ma99) score+=20
score+=20
score+=15

let shortPump=(price/prevClose)>1.015
if(shortPump) score+=10

let rapidPull=(price-ma7)/ma7<0.01
if(rapidPull) score+=15

let overExtend=(price-ma7)/ma7>0.04
if(overExtend) score-=30

if(score>=85 && !positions[s]){

let supportData=await calculateSupport(s,price)
if(!supportData) return

positions[s]={
entry:price,
support:supportData.support,
risk:supportData.riskPercent,
leverage:supportData.leverage,
time:Date.now()
}

sendTG(
`ğŸ“ˆ é€²å ´ ${s}
åƒ¹æ ¼:${price}
æ­¢æ:${supportData.support}
é¢¨éšª:${supportData.riskPercent}%
å»ºè­°æ§“æ¡¿:${supportData.leverage}x`
)
}

let exitSignal=""
if(positions[s]){
let entry=positions[s].entry
let support=parseFloat(positions[s].support)
let profit=((price-entry)/entry*100).toFixed(2)

if(price<=support){
exitSignal="è§¸ç™¼æ­¢æ"
}

if(exitSignal!=""){
sendTG(`âš  å‡ºå ´ ${s}
åŸå› :${exitSignal}
åƒ¹æ ¼:${price}
æµ®å‹•:${profit}%`)
delete positions[s]
}

renderCard(s,price,score,positions[s],profit,exitSignal)
return
}

if(score>=75){
renderCard(s,price,score,null,null,"")
}

}catch(e){}
}

function renderCard(s,p,score,pos,profit,exitSignal){

let el=document.getElementById('card-'+s)
if(!el){
el=document.createElement('div')
el.id='card-'+s
document.getElementById('main').appendChild(el)
}

let cls="card"
if(exitSignal) cls+=" exit"
else if(pos) cls+=" hold"
else cls+=" "+(score>=90?'high':score>=85?'mid':'low')

el.className=cls

el.innerHTML=`
<div class="flex justify-between">
<span>${s}</span>
<span>${score}åˆ†</span>
</div>
<div>ç¾åƒ¹ ${p}</div>
${pos?`<div>é€²å ´ ${pos.entry}</div>`:""}
${pos?`<div>æ­¢æ ${pos.support}</div>`:""}
${pos?`<div>é¢¨éšª ${pos.risk}%</div>`:""}
${pos?`<div>æ§“æ¡¿ ${pos.leverage}x</div>`:""}
${profit?`<div>æµ®å‹• ${profit}%</div>`:""}
${exitSignal?`<div style="color:red">${exitSignal}</div>`:""}
`
}

function toggleSystem(){
running=!running
document.getElementById('toggle').innerText=running?'åœæ­¢':'é–‹å§‹æƒæ'
if(running) refreshAll()
}

function countdown(){
let t=0
setInterval(()=>{
if(!running) return
t+=100
let percent=(t/30000)*100
document.getElementById('bar').style.width=percent+'%'
if(t>=30000){
t=0
refreshAll()
}
},100)
}

countdown()

</script>
</body>
</html>
