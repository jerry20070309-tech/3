<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TRIDENT V50 PRO</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{background:#000;color:#fff;font-family:monospace}
.card{background:#111;border:1px solid #222;padding:12px;margin-bottom:8px}
.bar{height:6px;background:#222;margin-top:6px}
.fill{height:6px;background:#00ff88}
.log{background:#111;border:1px solid #333;height:300px;overflow:auto;padding:10px}
</style>
</head>
<body class="p-6">

<h1 class="text-xl mb-4">TRIDENT V50 PRO</h1>
<button onclick="ignite()" class="bg-green-600 px-4 py-2 mb-4">å•Ÿå‹•æƒæ</button>

<div id="progress" class="bar mb-4"><div id="progressFill" class="fill" style="width:0%"></div></div>

<div class="flex gap-6">
<div class="flex-1" id="list"></div>
<div class="w-80">
<div class="log" id="log"></div>
</div>
</div>

<script>

const FIRST_SCAN = 400
const ACTIVE_LIMIT = 100
const REFRESH_INTERVAL = 30000
const OI_INTERVAL = 300000
const FUNDING_INTERVAL = 600000

let universe = []
let activeSymbols = []
let market = {}
let ws
let alerted = new Set()

// ===== å•Ÿå‹• =====

async function ignite(){
await loadUniverse()
await initActive()
startWS()
startTimers()
}

// ===== ç¬¬ä¸€æ¬¡æŠ“400 =====

async function loadUniverse(){
const tickers = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr').then(r=>r.json())
universe = tickers
.filter(t=>t.symbol.endsWith('USDT'))
.sort((a,b)=>b.quoteVolume-a.quoteVolume)
.slice(0,FIRST_SCAN)
.map(t=>t.symbol)
}

// ===== åªæŠ“å‰100å®Œæ•´è³‡æ–™ =====

async function initActive(){
activeSymbols = universe.slice(0,ACTIVE_LIMIT)

for(const s of activeSymbols){
await loadSymbolData(s)
}
render()
}

async function loadSymbolData(s){

const k = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=15m&limit=50`).then(r=>r.json())
const oi = await fetch(`https://fapi.binance.com/futures/data/openInterestHist?symbol=${s}&period=15m&limit=2`).then(r=>r.json())
const funding = await fetch(`https://fapi.binance.com/fapi/v1/fundingRate?symbol=${s}&limit=1`).then(r=>r.json())

const closes = k.map(x=>parseFloat(x[4]))
const slope = (closes.at(-1)-closes[0])/closes[0]*100

market[s] = {
price: closes.at(-1),
avg: closes.reduce((a,b)=>a+b)/closes.length,
slope,
oi: oi.length>1 ? (oi[1].sumOpenInterest-oi[0].sumOpenInterest)/oi[0].sumOpenInterest*100 : 0,
funding: funding[0]? parseFloat(funding[0].fundingRate)*100 : 0,
score:0
}

calcScore(s)
}

function calcScore(s){
const d = market[s]
let score = 0

if(d.price > d.avg) score+=20
if(d.slope > 1) score+=20
if(d.oi > 0) score+=20
if(d.funding > -0.01) score+=20
if(d.price > d.avg*1.01) score+=20

d.score = score

if(score==100 && !alerted.has(s)){
log("ğŸ”¥ STRONG ENTRY "+s+" 100")
alerted.add(s)
}
}

// ===== åªé‡ç®— ä¸å†æŠ“Kç·š =====

function recalcAll(){
activeSymbols.forEach(s=>calcScore(s))
render()
}

// ===== OIæ›´æ–° =====

async function updateOI(){
for(const s of activeSymbols){
const oi = await fetch(`https://fapi.binance.com/futures/data/openInterestHist?symbol=${s}&period=15m&limit=2`).then(r=>r.json())
if(oi.length>1){
market[s].oi = (oi[1].sumOpenInterest-oi[0].sumOpenInterest)/oi[0].sumOpenInterest*100
}
}
}

// ===== Fundingæ›´æ–° =====

async function updateFunding(){
for(const s of activeSymbols){
const funding = await fetch(`https://fapi.binance.com/fapi/v1/fundingRate?symbol=${s}&limit=1`).then(r=>r.json())
if(funding[0]){
market[s].funding = parseFloat(funding[0].fundingRate)*100
}
}
}

// ===== WebSocketåªæ›´æ–°åƒ¹æ ¼ =====

function startWS(){
ws = new WebSocket("wss://fstream.binance.com/ws/!ticker@arr")
ws.onmessage = e=>{
const arr = JSON.parse(e.data)
arr.forEach(t=>{
if(market[t.s]){
market[t.s].price = parseFloat(t.c)
calcScore(t.s)
}
})
render()
}
}

// ===== è¨ˆæ™‚å™¨ =====

function startTimers(){

let elapsed=0
setInterval(()=>{
elapsed+=100
document.getElementById("progressFill").style.width=(elapsed/REFRESH_INTERVAL*100)+"%"
if(elapsed>=REFRESH_INTERVAL){
elapsed=0
recalcAll()
}
},100)

setInterval(updateOI,OI_INTERVAL)
setInterval(updateFunding,FUNDING_INTERVAL)
}

// ===== UI =====

function render(){

const container=document.getElementById("list")
container.innerHTML=""

activeSymbols
.sort((a,b)=>market[b].score-market[a].score)
.forEach(s=>{
const d=market[s]
const card=document.createElement("div")
card.className="card"
card.innerHTML=`
<div class="flex justify-between">
<div>${s}</div>
<div>${d.score}</div>
</div>
<div class="bar"><div class="fill" style="width:${d.score}%"></div></div>
`
container.appendChild(card)
})
}

function log(t){
const div=document.createElement("div")
div.innerText=t
document.getElementById("log").prepend(div)
}

</script>
</body>
</html>
