<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>TRIDENT V6 PRO</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{background:#050505;color:#d4d4d8;font-family:monospace;overflow:hidden}
.card{background:#0f0f11;border:1px solid #222;padding:12px;border-radius:8px;transition:.3s}
.card:hover{transform:scale(1.02)}
.progress{height:3px;background:#3b82f6;width:0%}
.high{border:2px solid #22c55e}
.mid{border:2px solid #f59e0b}
.low{border:2px solid #ef4444}
</style>
</head>
<body class="p-6 h-screen flex flex-col">

<header class="flex justify-between items-center mb-4">
<h1 class="text-2xl font-bold">TRIDENT V6 PRO</h1>
<div class="flex items-center gap-4">
<div class="w-48 bg-zinc-800 rounded-full overflow-hidden">
<div id="bar" class="progress"></div>
</div>
<button id="toggle" onclick="toggleSystem()" class="bg-blue-600 px-4 py-2 rounded">é–‹å•Ÿ</button>
</div>
</header>

<div class="flex flex-1 gap-4 overflow-hidden">
<div id="main" class="flex-1 grid grid-cols-3 gap-3 overflow-y-auto"></div>
<div class="w-80 border border-zinc-800 rounded p-2 overflow-y-auto">
<h2 class="text-sm mb-2">ä½é¢¨éšªç´€éŒ„æ¿</h2>
<div id="record"></div>
</div>
</div>

<script>

const PUSHOVER_TOKEN = "a1s9cwmwgcus2m5cuwobmiuejxa8os"
const PUSHOVER_USER = "uehhd7arweucx7eyt572nujicuqgcs"

const EXCLUDE=[
'BTCUSDT','ETHUSDT','SOLUSDT','BNBUSDT','ADAUSDT','XRPUSDT',
'XAUUSDT','XAGUSDT'
]

const MARKETCAP_EXCLUDE=[]

let running=false
let dataStore={}
let alerted=new Set()
let recordSet=new Set()

function toggleSystem(){
running=!running
document.getElementById('toggle').innerText=running?'åœæ­¢':'é–‹å•Ÿ'
if(running){start()}
}

async function start(){
await refreshAll()
countdown()
}

async function refreshAll(){
if(!running)return
try{
const tickers=await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr').then(r=>r.json())
let list=tickers
.filter(t=>t.symbol.endsWith('USDT'))
.filter(t=>!EXCLUDE.includes(t.symbol))
.sort((a,b)=>b.quoteVolume-a.quoteVolume)
.slice(35,135)

for(let t of list){
await loadSymbol(t.symbol)
await new Promise(r=>setTimeout(r,80))
}
}catch(e){}
}

async function loadSymbol(s){
try{

const k15=await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=15m&limit=120`).then(r=>r.json())
const k4=await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=4h&limit=120`).then(r=>r.json())

const ma=(arr,n)=>arr.slice(-n).reduce((a,b)=>a+parseFloat(b[4]),0)/n

let ma7=ma(k15,7)
let ma20=ma(k15,20)
let ma25=ma(k15,25)
let ma99=ma(k15,99)

let poc4=calcPOC(k4)
let poc15=calcPOC(k15)

let price=parseFloat(k15[k15.length-1][4])

let volAvg=k15.reduce((a,b)=>a+parseFloat(b[5]),0)/k15.length
let volNow=parseFloat(k15[k15.length-1][5])

let bigOrder=volNow>volAvg*3
let denseOrder=volNow>volAvg*2

let break4=price>poc4
let break15=price>poc15

let structure=ma7>ma20&&ma20>ma25&&ma25>ma99

let bottom=Math.min(...k4.slice(-20).map(x=>parseFloat(x[3])))
let fakeBreak=price<bottom

let rapidPull=(price-bottom)/bottom>0.03

let score=0
if(break4)score+=20
if(break15)score+=15
if(structure)score+=20
if(bigOrder)score+=20
if(denseOrder)score+=15
if(rapidPull)score+=15

if(score>=75){
renderCard(s,price,score)
if(score>=85&&!alerted.has(s)){
sendPushover(s,price,score)
alerted.add(s)
}
if(score>=85&&!recordSet.has(s)){
addRecord(s,price)
recordSet.add(s)
}
}

}catch(e){}
}

function calcPOC(k){
let bins={}
k.forEach(c=>{
let p=parseFloat(c[4])
let v=parseFloat(c[5])
let key=Math.round(p*100)/100
bins[key]=(bins[key]||0)+v
})
let max=0,res=0
for(let b in bins){
if(bins[b]>max){max=bins[b];res=parseFloat(b)}
}
return res
}

function renderCard(s,p,score){
let el=document.getElementById('card-'+s)
if(!el){
el=document.createElement('div')
el.id='card-'+s
document.getElementById('main').appendChild(el)
}
el.className='card '+(score>=95?'high':score>=90?'mid':'low')
el.innerHTML=`
<div class="flex justify-between">
<span>${s}</span>
<span>${score}åˆ†</span>
</div>
<div>ç¾åƒ¹ ${p}</div>
`
}

function addRecord(s,p){
let div=document.createElement('div')
div.innerText=`${s} ${p}`
document.getElementById('record').prepend(div)
}

/* ğŸ”” ç›´æ¥æ¨é€ Pushover */

function sendPushover(s,p,score){

const formData = new URLSearchParams()
formData.append("token",PUSHOVER_TOKEN)
formData.append("user",PUSHOVER_USER)
formData.append("title","TRIDENT V6 PRO")
formData.append("message",`ğŸš€ ${s} ${score}åˆ† ç¾åƒ¹:${p}`)
formData.append("priority",score>=95?1:0)

fetch("https://api.pushover.net/1/messages.json",{
method:"POST",
body:formData
})

}

function countdown(){
let t=0
setInterval(()=>{
if(!running)return
t+=100
let percent=(t/30000)*100
document.getElementById('bar').style.width=percent+'%'
if(t>=30000){
t=0
refreshAll()
}
},100)
}

</script>
</body>
</html>
