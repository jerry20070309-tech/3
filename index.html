<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>âš¡ SNIPER V27.0 | æ ¸å¿ƒå…¨è£œå®Œç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');
        body { background: #010101; color: #FFD700; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
        .card { background: #050505; border: 1px solid #1a1a1a; border-radius: 4px; padding: 12px; transition: 0.2s; position: relative; }
        .tight-zone { border: 1px solid #eab308; background: linear-gradient(135deg, #0a0a00, #000); }
        .monster-boost { border: 2px solid #ef4444 !important; animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 5px #450a0a; } 50% { box-shadow: 0 0 20px #ef4444; } 100% { box-shadow: 0 0 5px #450a0a; } }
        /* [æ‰¾å›] é‡åƒ¹èƒŒé›¢ç™¼å…‰è¦–è¦º */
        .divergence-up { color: #22c55e; text-shadow: 0 0 8px #22c55e; }
        .divergence-down { color: #ef4444; text-shadow: 0 0 8px #ef4444; }
        .bar-container { background: #111; height: 3px; border-radius: 2px; margin: 4px 0; overflow: hidden; }
        .bar-power { height: 100%; background: #2563eb; transition: 0.5s ease-out; }
        .trade-row { display: flex; justify-content: space-between; font-size: 7px; border-bottom: 1px solid #111; padding: 1px 0; }
    </style>
</head>
<body class="h-screen flex flex-col p-2 text-[10px]">

    <header class="p-3 border-b border-yellow-900/50 flex justify-between items-center">
        <div class="flex items-center gap-6">
            <h1 class="text-2xl font-black text-yellow-500 italic tracking-tighter">âš¡ SNIPER V27.0</h1>
            <div id="dayStrategy" class="px-3 py-1 bg-blue-900/20 border border-blue-500/50 text-blue-400 font-bold rounded">ç­‰å¾…åˆå§‹åŒ–...</div>
        </div>
        <div class="flex gap-4 items-center">
            <button id="switchBtn" onclick="toggleSystem()" class="bg-yellow-500 hover:bg-yellow-400 text-black px-6 py-2 font-black rounded transition-all">START RADAR</button>
            <div id="apiStatus" class="font-bold text-zinc-600 border border-zinc-800 px-4 py-2 rounded">SYSTEM: IDLE</div>
        </div>
    </header>

    <div class="bg-zinc-900/20 p-2 grid grid-cols-6 gap-4 border-b border-yellow-900/10">
        <div>ğŸŒ€ SQZæ©«ç›¤ <span id="v_sqz" class="text-yellow-500 font-bold">1.2%</span><input type="range" id="i_sqz" min="5" max="50" value="12" class="w-full mt-1 accent-yellow-500"></div>
        <div>ğŸ¯ POCçªç ´ <span id="v_poc" class="text-green-500 font-bold">1.1%</span><input type="range" id="i_poc" min="5" max="50" value="11" class="w-full mt-1 accent-green-500"></div>
        <div>ğŸš¨ SLPä¹–é›¢ <span id="v_slp" class="text-red-500 font-bold">1.5%</span><input type="range" id="i_slp" min="5" max="50" value="15" class="w-full mt-1 accent-red-500"></div>
        <div>ğŸš€ DRVçœŸç©º <span id="v_drv" class="text-blue-500 font-bold">90</span><input type="range" id="i_drv" min="10" max="150" value="90" class="w-full mt-1 accent-blue-500"></div>
        <div>âš¡ MOMå‡ç·š <span id="v_mom" class="text-orange-500 font-bold">0.8%</span><input type="range" id="i_mom" min="1" max="50" value="8" class="w-full mt-1 accent-orange-500"></div>
        <div>ğŸ“Š RSIé–¾å€¼ <span id="v_rsi" class="text-purple-400 font-bold">70</span><input type="range" id="i_rsi" min="50" max="90" value="70" class="w-full mt-1 accent-purple-400"></div>
    </div>

    <div class="flex flex-1 overflow-hidden mt-2 gap-2">
        <main id="dashboard" class="flex-1 overflow-y-auto grid grid-cols-4 gap-3 p-1 content-start"></main>
        <aside class="w-80 bg-black border-l border-yellow-900/30 flex flex-col">
            <div class="p-2 border-b border-zinc-800 text-[10px] font-black italic flex justify-between uppercase">
                <span class="text-red-600">ğŸ›¡ï¸ WHALE SURVEILLANCE</span>
                <span id="pwrStatus" class="text-zinc-700 font-mono italic">PULSE: 3.0s</span>
            </div>
            <div id="logBox" class="flex-1 overflow-y-auto p-2 space-y-1 font-mono text-[9px]"></div>
        </aside>
    </div>

<script>
    let isRunning = false, stats = {}, activeWS = new Map();
    let FILTER = { SQZ: 0.012, POC: 0.011, SLP: 0.015, DRV: 90, MOM: 0.008, RSI: 70 };
    let step = 0;

    function toggleSystem() {
        isRunning = !isRunning;
        const b = document.getElementById('switchBtn');
        b.innerText = isRunning ? "STOP RADAR" : "START RADAR";
        b.style.backgroundColor = isRunning ? "#ef4444" : "#eab308";
        document.getElementById('apiStatus').innerText = isRunning ? "SYSTEM: ACTIVE" : "SYSTEM: IDLE";
        if (isRunning) masterClock();
    }

    // [æ ¸å¿ƒ] ç‰©ç†é™é »ä¸‰æ®µå¼è„ˆè¡
    async function masterClock() {
        if (!isRunning) return;
        try {
            if (step === 0) {
                const r = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
                const data = await r.json();
                data.forEach(t => {
                    if (!t.symbol.endsWith('USDT')) return;
                    const s = t.symbol, p = parseFloat(t.lastPrice), h = parseFloat(t.highPrice), l = parseFloat(t.lowPrice);
                    const chg = parseFloat(t.priceChangePercent);
                    let score = ((h-l)/p <= FILTER.SQZ) ? 40 : 0;
                    if (chg > 5) score += 30;
                    if (!stats[s]) stats[s] = { s, score:0, price:p, oldP:p, funding:0, bid:0, ask:0, liq:0, buyV:0, sellV:0, vol:parseFloat(t.quoteVolume), trades:[] };
                    stats[s] = { ...stats[s], price:p, score, vol:parseFloat(t.quoteVolume), chg, isVac: (h-p)/p < 0.003 };
                });
                step = 1;
            } else if (step === 1) {
                const r = await fetch('https://fapi.binance.com/fapi/v1/premiumIndex');
                const data = await r.json();
                data.forEach(p => { if(stats[p.symbol]) stats[p.symbol].funding = p.lastFundingRate; });
                step = 2;
            } else {
                const top = Object.values(stats).sort((a,b) => b.score - a.score)[0];
                if (top) {
                    const r = await fetch(`https://fapi.binance.com/fapi/v1/depth?symbol=${top.s}&limit=20`);
                    const d = await r.json();
                    stats[top.s].ask = d.asks.reduce((a,b)=>a+parseFloat(b[1]),0);
                    stats[top.s].bid = d.bids.reduce((a,b)=>a+parseFloat(b[1]),0);
                    setupWS(top.s);
                }
                step = 0;
            }
            render();
        } catch (e) { console.warn("API Busy - Syncing..."); }
        setTimeout(masterClock, 1000); 
    }

    function setupWS(s) {
        if (activeWS.has(s)) return;
        const ws = new WebSocket(`wss://fstream.binance.com/ws/${s.toLowerCase()}@aggTrade/${s.toLowerCase()}@forceOrder`);
        ws.onmessage = (e) => {
            const d = JSON.parse(e.data);
            if (d.e === "forceOrder") {
                const val = (parseFloat(d.o.q) * parseFloat(d.o.p) / 1000).toFixed(1);
                stats[s].liq += parseFloat(val);
                addLog(`ğŸ’€ [LIQ] ${s} $${val}K`, "text-red-500 font-bold");
            }
            if (d.e === "aggTrade") {
                const usd = parseFloat(d.q) * parseFloat(d.p);
                if (usd > 50000) {
                    const side = d.m ? "SELL" : "BUY";
                    if (side === "BUY") stats[s].buyV += usd; else stats[s].sellV += usd;
                    stats[s].trades.unshift({ t: new Date().toLocaleTimeString().slice(3), p: d.p, v: (usd/1000).toFixed(0), s: side });
                    if (stats[s].trades.length > 5) stats[s].trades.pop();
                    addLog(`ğŸ‹ [WHALE] ${s} $${(usd/1000).toFixed(0)}K | ${side}`, d.m ? "text-orange-500" : "text-green-500 border-l border-green-500 pl-1");
                }
            }
        };
        activeWS.set(s, ws);
    }

    function render() {
        const board = document.getElementById('dashboard');
        const sorted = Object.values(stats).sort((a,b) => b.score - a.score).slice(0, 24);
        board.innerHTML = sorted.map(x => {
            const flow = (x.buyV - x.sellV)/1000;
            const power = (x.bid / (x.bid + x.ask) * 100) || 50;
            const divClass = (x.price > x.oldP && flow < 0) ? 'divergence-down' : (x.price < x.oldP && flow > 0 ? 'divergence-up' : 'text-zinc-400');
            return `
            <div class="card ${x.score >= 50 ? 'tight-zone' : ''} ${x.vol > 1e9 ? 'monster-boost' : ''}">
                <div class="flex justify-between font-black text-[11px]">
                    <span class="text-white">${x.s}</span>
                    <span class="text-yellow-500">â˜…${x.score}</span>
                </div>
                <div class="text-2xl font-black text-white py-1 italic tracking-tighter">$${x.price}</div>
                <div class="flex justify-between text-[8px] font-bold">
                    <span class="${x.chg >= 0 ? 'text-green-500' : 'text-red-500'}">${x.chg}%</span>
                    <span class="${x.funding < 0 ? 'text-red-500' : 'text-green-500'}">F: ${(x.funding*100).toFixed(4)}%</span>
                </div>
                <div class="bar-container"><div class="bar-power" style="width: ${power}%"></div></div>
                <div class="flex justify-between text-[8px] font-bold mt-1 uppercase">
                    <span class="${divClass}">NET: $${flow.toFixed(0)}K</span>
                    <span class="text-zinc-600">LIQ: $${x.liq.toFixed(0)}K</span>
                </div>
                <div class="bg-black/60 rounded mt-1 p-1 min-h-[42px]">
                    ${x.trades.map(t => `<div class="trade-row ${t.s==='BUY'?'text-green-500':'text-orange-500'}"><span>${t.t}</span><span>$${t.p}</span><span>$${t.v}K</span></div>`).join('')}
                </div>
                ${x.isVac ? '<div class="absolute bottom-1 right-1 text-[7px] bg-blue-600 text-white px-1 rounded font-bold">VACUUM</div>' : ''}
            </div>`;
        }).join('');
    }

    // [æ‰¾å›] æ»‘æ¡¿èª¿ç¯€èˆ‡é€±å…­æŒ‡ä»¤
    const sIds = ['i_sqz', 'i_poc', 'i_slp', 'i_drv', 'i_mom', 'i_rsi'];
    sIds.forEach(id => {
        document.getElementById(id).oninput = (e) => {
            const key = id.split('_')[1].toUpperCase();
            FILTER[key] = parseFloat(e.target.value) / (key === 'RSI' ? 1 : 1000);
            document.getElementById('v_'+id.split('_')[1]).innerText = (key==='RSI'?e.target.value:(e.target.value/10).toFixed(1) + '%');
            render();
        };
    });

    const day = new Date().getDay();
    if (day === 6) { 
        document.getElementById('dayStrategy').innerText = "ğŸ“… é€±å…­æ¨¡å¼ï¼šæ•¸æ“šéš”é›¢"; 
        FILTER.SQZ = 0.008; 
    }

    function addLog(m, c) {
        const b = document.getElementById('logBox');
        const d = document.createElement('div'); d.className = `p-1 border-b border-zinc-900 ${c}`;
        d.innerHTML = `[${new Date().toLocaleTimeString()}] ${m}`;
        b.prepend(d); if(b.childNodes.length > 50) b.removeChild(b.lastChild);
    }
</script>
</body>
</html>
