<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TRIDENT V53 PRE BREAKOUT</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{background:#000;color:#fff;font-family:monospace}
.card{background:#111;border:1px solid #222;padding:12px;margin-bottom:10px}
.bar{height:6px;background:#222;margin-top:6px}
.fill{height:6px;background:#00ff88}
.log{background:#111;border:1px solid #333;height:260px;overflow:auto;padding:10px}
</style>
</head>
<body class="p-6">

<h1 class="text-xl mb-4">TRIDENT V53 ‚Äì PRE BREAKOUT</h1>
<button onclick="ignite()" class="bg-green-600 px-4 py-2 mb-4">ÂïüÂãïÊéÉÊèè</button>

<div class="bar mb-4">
<div id="progress" class="fill" style="width:0%"></div>
</div>

<div class="flex gap-6">
<div class="flex-1" id="list"></div>
<div class="w-80">
<div class="log" id="log"></div>
</div>
</div>

<script>

const INITIAL_LOAD = 400
const ACTIVE_LIMIT = 100
const DISPLAY_LIMIT = 10
const REFRESH_INTERVAL = 30000

let universe=[]
let active=[]
let market={}
let alerted=new Set()
let ws

const EXCLUDE=["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT","ADAUSDT"]

// ===== ÂïüÂãï =====

async function ignite(){
await loadUniverse()
await initActive()
startWS()
startTimer()
}

// ===== Âª∫Á´ãÂπ£Ê±† =====

async function loadUniverse(){

const tickers=await fetch("https://fapi.binance.com/fapi/v1/ticker/24hr")
.then(r=>r.json())

universe=tickers
.filter(t=>t.symbol.endsWith("USDT"))
.filter(t=>!EXCLUDE.includes(t.symbol))
.sort((a,b)=>b.quoteVolume-a.quoteVolume)
.slice(30,430) // ÊéíÈô§ÂâçÊÆµ
.map(t=>t.symbol)

}

// ===== ÂàùÂßãÂåñ100Èöª =====

async function initActive(){

active=universe.slice(0,ACTIVE_LIMIT)

for(const s of active){
await loadSymbol(s)
}

render()
}

// ===== ÊäìÂÆåÊï¥Á≠ñÁï•Êï∏Êìö =====

async function loadSymbol(s){

const [k,oi15,oi1h,funding]=await Promise.all([
fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=15m&limit=50`).then(r=>r.json()),
fetch(`https://fapi.binance.com/futures/data/openInterestHist?symbol=${s}&period=15m&limit=2`).then(r=>r.json()),
fetch(`https://fapi.binance.com/futures/data/openInterestHist?symbol=${s}&period=1h&limit=2`).then(r=>r.json()),
fetch(`https://fapi.binance.com/fapi/v1/fundingRate?symbol=${s}&limit=1`).then(r=>r.json())
])

const closes=k.map(x=>parseFloat(x[4]))
const vols=k.map(x=>parseFloat(x[5]))

const high=Math.max(...closes)
const low=Math.min(...closes)
const price=closes.at(-1)

const slope=(price-closes[0])/closes[0]*100
const avgVol=vols.reduce((a,b)=>a+b)/vols.length
const volRatio=vols.at(-1)/avgVol

const oi15delta=calcDelta(oi15)
const oi1hdelta=calcDelta(oi1h)

const fundingRate=parseFloat(funding[0]?.fundingRate||0)

market[s]={
price,high,low,slope,volRatio,
oi15:oi15delta,
oi1h:oi1hdelta,
funding:fundingRate,
score:0
}

calcScore(s)
}

function calcDelta(data){
if(!data||data.length<2) return 0
return (parseFloat(data[1].sumOpenInterest)
-parseFloat(data[0].sumOpenInterest))
/parseFloat(data[0].sumOpenInterest)*100
}

// ===== ÁàÜÁôºË©ïÂàÜ =====

function calcScore(s){

const d=market[s]
let score=0

// 1 Êé•ËøëÁ™ÅÁ†¥
if(d.price>d.high*0.985) score+=20

// 2 ÂãïËÉΩÂâõËµ∑
if(d.slope>1.5 && d.slope<6) score+=20

// 3 Êàê‰∫§ÈáèÊîæÂ§ß
if(d.volRatio>1.8) score+=20

// 4 OI ÂêåÊ≠•Â¢û
if(d.oi15>0.5 && d.oi1h>0.5) score+=20

// 5 Funding Ê≠£Â∏∏
if(Math.abs(d.funding)<0.01) score+=20

d.score=score

if(score==100 && !alerted.has(s)){
log("üöÄ BREAKOUT READY "+s+" 100")
alerted.add(s)
}
}

// ===== WebSocket Âè™Êõ¥Êñ∞ÂÉπÊ†º =====

function startWS(){

ws=new WebSocket("wss://fstream.binance.com/ws/!ticker@arr")

ws.onmessage=e=>{
const arr=JSON.parse(e.data)
arr.forEach(t=>{
if(market[t.s]){
market[t.s].price=parseFloat(t.c)
calcScore(t.s)
}
})
render()
}
}

// ===== 30ÁßíÈáçÁÆó =====

function startTimer(){

let elapsed=0

setInterval(()=>{
elapsed+=100
document.getElementById("progress").style.width=
(elapsed/REFRESH_INTERVAL*100)+"%"

if(elapsed>=REFRESH_INTERVAL){
elapsed=0
active.forEach(s=>calcScore(s))
render()
}
},100)

}

// ===== UI =====

function render(){

const container=document.getElementById("list")
container.innerHTML=""

active
.sort((a,b)=>market[b].score-market[a].score)
.slice(0,DISPLAY_LIMIT)
.forEach(s=>{
const d=market[s]
const card=document.createElement("div")
card.className="card"
card.innerHTML=`
<div class="flex justify-between">
<div>${s}</div>
<div>${d.score}</div>
</div>
<div class="bar">
<div class="fill" style="width:${d.score}%"></div>
</div>
`
container.appendChild(card)
})
}

function log(text){
const div=document.createElement("div")
div.innerText=text
document.getElementById("log").prepend(div)
}

</script>
</body>
</html>
