<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>‚öî TRIDENT V47 PRO</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{background:#000;color:#ddd;font-family:monospace}
.card{background:#111;border:1px solid #222;padding:14px;border-radius:8px}
.tag{padding:2px 6px;border-radius:4px;font-size:10px;font-weight:bold}
.good{background:#064e3b;color:#34d399}
.bad{background:#450a0a;color:#f87171}
.neutral{background:#222;color:#aaa}
.progress{height:4px;background:#222;margin:10px 0}
.bar{height:4px;background:#10b981;width:0%}
.alert{border:1px solid #facc15}
.log{background:#0a0a0a;border:1px solid #222}
</style>
</head>
<body class="p-6">

<h1 class="text-2xl mb-4">TRIDENT V47 PRO</h1>
<button onclick="ignite()" class="bg-green-600 px-4 py-2 mb-4 rounded">ÂïüÂãïÊéÉÊèè</button>

<div class="progress"><div id="timeBar" class="bar"></div></div>

<div class="flex gap-6">
<div id="list" class="flex-1 space-y-4"></div>

<div class="w-72 log p-3">
<h2 class="mb-2">Signal Log</h2>
<div id="log"></div>
</div>
</div>

<script>
let symbols=[]
let market={}
let ws
let timer=0
const INTERVAL=30000

async function ignite(){
await loadUniverse()
startWS()
setInterval(loop,1000)
}

async function loadUniverse(){
let data=await fetch("https://fapi.binance.com/fapi/v1/ticker/24hr").then(r=>r.json())
symbols=data.filter(x=>x.symbol.endsWith("USDT"))
.sort((a,b)=>b.quoteVolume-a.quoteVolume)
.slice(0,80)
.map(x=>x.symbol)

for(let s of symbols){
await initSymbol(s)
await new Promise(r=>setTimeout(r,50))
}
render()
}

async function initSymbol(s){
let k=await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=15m&limit=50`).then(r=>r.json())
let oi15=await fetch(`https://fapi.binance.com/futures/data/openInterestHist?symbol=${s}&period=15m&limit=2`).then(r=>r.json())
let oi1h=await fetch(`https://fapi.binance.com/futures/data/openInterestHist?symbol=${s}&period=1h&limit=2`).then(r=>r.json())
let funding=await fetch(`https://fapi.binance.com/fapi/v1/fundingRate?symbol=${s}&limit=1`).then(r=>r.json())

market[s]={
price:parseFloat(k[k.length-1][4]),
vwap:calcVWAP(k),
poc:calcPOC(k),
slope:calcSlope(k),
oi15:calcOI(oi15),
oi1h:calcOI(oi1h),
fund: funding[0]?parseFloat(funding[0].fundingRate):0,
score:0,
tags:[]
}
}

function calcVWAP(k){
let pv=0,v=0
k.forEach(x=>{
let p=parseFloat(x[4])
let vol=parseFloat(x[5])
pv+=p*vol
v+=vol
})
return pv/v
}

function calcPOC(k){
let bins={}
k.forEach(x=>{
let p=parseFloat(x[4]).toFixed(2)
bins[p]=(bins[p]||0)+parseFloat(x[5])
})
return parseFloat(Object.keys(bins).reduce((a,b)=>bins[a]>bins[b]?a:b))
}

function calcSlope(k){
let first=parseFloat(k[0][4])
let last=parseFloat(k[k.length-1][4])
return (last-first)/first*100
}

function calcOI(d){
if(!d||d.length<2)return 0
return (parseFloat(d[1].sumOpenInterest)-parseFloat(d[0].sumOpenInterest))
/parseFloat(d[0].sumOpenInterest)*100
}

function evaluate(s){
let m=market[s]
let score=0
let tags=[]

if(m.price>m.vwap){score+=15;tags.push("VWAP")}
if(m.price>m.poc){score+=15;tags.push("POC")}
if(m.slope>1){score+=15;tags.push("MOMO")}
if(m.oi15>2){score+=15;tags.push("VOL")}
if(m.oi1h>2){score+=15;tags.push("STR")}
if(Math.abs(m.fund)<0.01){score+=10;tags.push("FUND")}
if(m.price>m.poc*1.01){score+=15;tags.push("BRK")}

m.score=score
m.tags=tags
}

function render(){
let container=document.getElementById("list")
container.innerHTML=""
symbols.forEach(s=>evaluate(s))

symbols.sort((a,b)=>market[b].score-market[a].score)

symbols.forEach(s=>{
let m=market[s]
let div=document.createElement("div")
div.className="card "+(m.score>=85?"alert":"")
div.innerHTML=`
<div class="flex justify-between">
<span>${s}</span>
<span>${m.score}</span>
</div>
<div class="flex gap-1 mt-2 flex-wrap">
${m.tags.map(t=>`<span class="tag good">${t}</span>`).join("")}
</div>
<div class="text-xs mt-2">Áº∫Â∞ë ${7-m.tags.length} Ê¢ù‰ª∂</div>
`
container.appendChild(div)

if(m.score>=95){
addLog(s,m.score)
}
})
}

function addLog(s,score){
let log=document.getElementById("log")
let div=document.createElement("div")
div.innerText=`üö® STRONG ENTRY ${s} ${score}`
log.prepend(div)
}

function startWS(){
ws=new WebSocket("wss://fstream.binance.com/ws/!ticker@arr")
ws.onmessage=(e)=>{
JSON.parse(e.data).forEach(t=>{
if(market[t.s]){
market[t.s].price=parseFloat(t.c)
}
})
}
}

function loop(){
timer+=1000
let percent=(timer/INTERVAL)*100
document.getElementById("timeBar").style.width=percent+"%"
if(timer>=INTERVAL){
timer=0
loadUniverse()
}
render()
}
</script>
</body>
</html>
